{"code":"import * as tslib_1 from \"tslib\";\r\nimport { detect } from \"detect-browser\";\r\nimport { AuthInfo, CoreStitchAuth, DeviceFields, StitchAuthResponseCredential, StitchClientError, StitchClientErrorCode } from \"mongodb-stitch-core-sdk\";\r\nimport version from \"../../internal/common/Version\";\r\nimport RedirectFragmentFields from \"./RedirectFragmentFields\";\r\nimport RedirectKeys from \"./RedirectKeys\";\r\nimport StitchRedirectError from \"./StitchRedirectError\";\r\nimport StitchUserFactoryImpl from \"./StitchUserFactoryImpl\";\r\nimport fetch from \"fetch-everywhere\";\r\nvar alphaNumericCharacters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\nvar StitchAuthImpl = (function (_super) {\r\n    tslib_1.__extends(StitchAuthImpl, _super);\r\n    function StitchAuthImpl(requestClient, browserAuthRoutes, authStorage, appInfo, jsdomWindow) {\r\n        if (jsdomWindow === void 0) { jsdomWindow = window; }\r\n        var _this = _super.call(this, requestClient, browserAuthRoutes, authStorage) || this;\r\n        _this.browserAuthRoutes = browserAuthRoutes;\r\n        _this.authStorage = authStorage;\r\n        _this.appInfo = appInfo;\r\n        _this.jsdomWindow = jsdomWindow;\r\n        _this.listeners = new Set();\r\n        return _this;\r\n    }\r\n    Object.defineProperty(StitchAuthImpl.prototype, \"userFactory\", {\r\n        get: function () {\r\n            return new StitchUserFactoryImpl(this);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    StitchAuthImpl.prototype.getProviderClient = function (factory, providerName) {\r\n        if (isAuthProviderClientFactory(factory)) {\r\n            return factory.getClient(this, this.requestClient, this.authRoutes);\r\n        }\r\n        else {\r\n            return factory.getNamedClient(providerName, this.requestClient, this.authRoutes);\r\n        }\r\n    };\r\n    StitchAuthImpl.prototype.loginWithCredential = function (credential) {\r\n        return _super.prototype.loginWithCredentialInternal.call(this, credential);\r\n    };\r\n    StitchAuthImpl.prototype.loginWithRedirect = function (credential) {\r\n        var _a = this.prepareRedirect(credential), redirectUrl = _a.redirectUrl, state = _a.state;\r\n        this.jsdomWindow.location.replace(this.browserAuthRoutes.getAuthProviderRedirectRoute(credential, redirectUrl, state, this.deviceInfo));\r\n    };\r\n    StitchAuthImpl.prototype.linkWithRedirectInternal = function (user, credential) {\r\n        var _this = this;\r\n        if (this.user !== undefined && user.id !== this.user.id) {\r\n            return Promise.reject(new StitchClientError(StitchClientErrorCode.UserNoLongerValid));\r\n        }\r\n        var _a = this.prepareRedirect(credential), redirectUrl = _a.redirectUrl, state = _a.state;\r\n        var link = this.browserAuthRoutes.getAuthProviderLinkRedirectRoute(credential, redirectUrl, state, this.deviceInfo);\r\n        return fetch(new Request(link, {\r\n            credentials: \"include\",\r\n            headers: {\r\n                Authorization: \"Bearer \" + this.authInfo.accessToken\r\n            },\r\n            mode: 'cors'\r\n        })).then(function (response) {\r\n            _this.jsdomWindow.location.replace(response.headers.get(\"X-Stitch-Location\"));\r\n        });\r\n    };\r\n    StitchAuthImpl.prototype.hasRedirectResult = function () {\r\n        var isValid = false;\r\n        try {\r\n            isValid = this.parseRedirect().isValid;\r\n            return isValid;\r\n        }\r\n        catch (_) {\r\n            return false;\r\n        }\r\n        finally {\r\n            if (!isValid) {\r\n                this.cleanupRedirect();\r\n            }\r\n        }\r\n    };\r\n    StitchAuthImpl.prototype.handleRedirectResult = function () {\r\n        try {\r\n            var providerName = this.authStorage.get(RedirectKeys.ProviderName);\r\n            var providerType = this.authStorage.get(RedirectKeys.ProviderType);\r\n            var redirectFragment = this.parseRedirect();\r\n            return this.loginWithCredentialInternal(new StitchAuthResponseCredential(this.processRedirectResult(redirectFragment), providerType, providerName, redirectFragment.asLink)).then(function (user) {\r\n                return user;\r\n            });\r\n        }\r\n        catch (err) {\r\n            return Promise.reject(err);\r\n        }\r\n    };\r\n    StitchAuthImpl.prototype.linkWithCredential = function (user, credential) {\r\n        return _super.prototype.linkUserWithCredentialInternal.call(this, user, credential);\r\n    };\r\n    StitchAuthImpl.prototype.logout = function () {\r\n        return Promise.resolve(_super.prototype.logoutInternal.call(this));\r\n    };\r\n    Object.defineProperty(StitchAuthImpl.prototype, \"deviceInfo\", {\r\n        get: function () {\r\n            var info = {};\r\n            if (this.hasDeviceId) {\r\n                info[DeviceFields.DEVICE_ID] = this.deviceId;\r\n            }\r\n            if (this.appInfo.localAppName !== undefined) {\r\n                info[DeviceFields.APP_ID] = this.appInfo.localAppName;\r\n            }\r\n            if (this.appInfo.localAppVersion !== undefined) {\r\n                info[DeviceFields.APP_VERSION] = this.appInfo.localAppVersion;\r\n            }\r\n            var browser = detect();\r\n            if (browser) {\r\n                info[DeviceFields.PLATFORM] = browser.name;\r\n                info[DeviceFields.PLATFORM_VERSION] = browser.version;\r\n            }\r\n            else {\r\n                info[DeviceFields.PLATFORM] = \"web\";\r\n                info[DeviceFields.PLATFORM_VERSION] = \"0.0.0\";\r\n            }\r\n            info[DeviceFields.SDK_VERSION] = version;\r\n            return info;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    StitchAuthImpl.prototype.addAuthListener = function (listener) {\r\n        this.listeners.add(listener);\r\n        this.onAuthEvent(listener);\r\n    };\r\n    StitchAuthImpl.prototype.removeAuthListener = function (listener) {\r\n        this.listeners.delete(listener);\r\n    };\r\n    StitchAuthImpl.prototype.onAuthEvent = function (listener) {\r\n        var _this = this;\r\n        if (listener) {\r\n            var auth_1 = this;\r\n            var _1 = new Promise(function (resolve) {\r\n                listener.onAuthEvent(auth_1);\r\n                resolve(undefined);\r\n            });\r\n        }\r\n        else {\r\n            this.listeners.forEach(function (one) {\r\n                _this.onAuthEvent(one);\r\n            });\r\n        }\r\n    };\r\n    StitchAuthImpl.prototype.cleanupRedirect = function () {\r\n        this.jsdomWindow.history.replaceState(null, \"\", this.pageRootUrl());\r\n        this.authStorage.remove(RedirectKeys.State);\r\n        this.authStorage.remove(RedirectKeys.ProviderName);\r\n        this.authStorage.remove(RedirectKeys.ProviderType);\r\n    };\r\n    StitchAuthImpl.prototype.parseRedirect = function () {\r\n        if (typeof this.jsdomWindow === \"undefined\") {\r\n            throw new StitchRedirectError(\"running in a non-browser environment\");\r\n        }\r\n        if (!this.jsdomWindow.location || !this.jsdomWindow.location.hash) {\r\n            throw new StitchRedirectError(\"window location hash was undefined\");\r\n        }\r\n        var ourState = this.authStorage.get(RedirectKeys.State);\r\n        var redirectFragment = this.jsdomWindow.location.hash.substring(1);\r\n        return parseRedirectFragment(redirectFragment, ourState, this.appInfo.clientAppId);\r\n    };\r\n    StitchAuthImpl.prototype.processRedirectResult = function (redirectFragment) {\r\n        try {\r\n            if (!redirectFragment.isValid) {\r\n                throw new StitchRedirectError(\"invalid redirect result\");\r\n            }\r\n            if (redirectFragment.lastError) {\r\n                throw new StitchRedirectError(\"error handling redirect: \" + redirectFragment.lastError);\r\n            }\r\n            if (!redirectFragment.authInfo) {\r\n                throw new StitchRedirectError(\"no user auth value was found: it could not be decoded from fragment\");\r\n            }\r\n        }\r\n        catch (err) {\r\n            throw err;\r\n        }\r\n        finally {\r\n            this.cleanupRedirect();\r\n        }\r\n        return redirectFragment.authInfo;\r\n    };\r\n    StitchAuthImpl.prototype.prepareRedirect = function (credential) {\r\n        this.authStorage.set(RedirectKeys.ProviderName, credential.providerName);\r\n        this.authStorage.set(RedirectKeys.ProviderType, credential.providerType);\r\n        var redirectUrl = credential.redirectUrl;\r\n        if (redirectUrl === undefined) {\r\n            redirectUrl = this.pageRootUrl();\r\n        }\r\n        var state = generateState();\r\n        this.authStorage.set(RedirectKeys.State, state);\r\n        return { redirectUrl: redirectUrl, state: state };\r\n    };\r\n    StitchAuthImpl.prototype.pageRootUrl = function () {\r\n        return [\r\n            this.jsdomWindow.location.protocol,\r\n            \"//\",\r\n            this.jsdomWindow.location.host,\r\n            this.jsdomWindow.location.pathname\r\n        ].join(\"\");\r\n    };\r\n    return StitchAuthImpl;\r\n}(CoreStitchAuth));\r\nexport default StitchAuthImpl;\r\nfunction generateState() {\r\n    var state = \"\";\r\n    for (var i = 0; i < 64; ++i) {\r\n        state += alphaNumericCharacters.charAt(Math.floor(Math.random() * alphaNumericCharacters.length));\r\n    }\r\n    return state;\r\n}\r\nfunction unmarshallUserAuth(data) {\r\n    var parts = data.split(\"$\");\r\n    if (parts.length !== 4) {\r\n        throw new StitchRedirectError(\"invalid user auth data provided while \" +\r\n            \"marshalling user authentication data: \" +\r\n            data);\r\n    }\r\n    var accessToken = parts[0], refreshToken = parts[1], userId = parts[2], deviceId = parts[3];\r\n    return new AuthInfo(userId, deviceId, accessToken, refreshToken);\r\n}\r\nvar ParsedRedirectFragment = (function () {\r\n    function ParsedRedirectFragment() {\r\n        this.stateValid = false;\r\n        this.clientAppIdValid = false;\r\n        this.asLink = false;\r\n    }\r\n    Object.defineProperty(ParsedRedirectFragment.prototype, \"isValid\", {\r\n        get: function () {\r\n            return this.stateValid && this.clientAppIdValid;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return ParsedRedirectFragment;\r\n}());\r\nfunction parseRedirectFragment(fragment, ourState, ourClientAppId) {\r\n    var vars = fragment.split(\"&\");\r\n    var result = new ParsedRedirectFragment();\r\n    vars.forEach(function (kvp) {\r\n        var pairParts = kvp.split(\"=\");\r\n        var pairKey = decodeURIComponent(pairParts[0]);\r\n        switch (pairKey) {\r\n            case RedirectFragmentFields.StitchError:\r\n                result.lastError = decodeURIComponent(pairParts[1]);\r\n                break;\r\n            case RedirectFragmentFields.UserAuth:\r\n                try {\r\n                    result.authInfo = unmarshallUserAuth(decodeURIComponent(pairParts[1]));\r\n                }\r\n                catch (e) {\r\n                    result.lastError = e;\r\n                }\r\n                break;\r\n            case RedirectFragmentFields.StitchLink:\r\n                if (pairParts[1] == \"ok\") {\r\n                    result.asLink = true;\r\n                }\r\n                break;\r\n            case RedirectFragmentFields.State:\r\n                var theirState = decodeURIComponent(pairParts[1]);\r\n                if (ourState === theirState) {\r\n                    result.stateValid = true;\r\n                }\r\n                break;\r\n            case RedirectFragmentFields.ClientAppId:\r\n                var clientAppId = decodeURIComponent(pairParts[1]);\r\n                if (ourClientAppId === clientAppId) {\r\n                    result.clientAppIdValid = true;\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    });\r\n    return result;\r\n}\r\nfunction isAuthProviderClientFactory(factory) {\r\n    return (factory.getClient !== undefined);\r\n}\r\n//# sourceMappingURL=StitchAuthImpl.js.map","map":"{\"version\":3,\"file\":\"StitchAuthImpl.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/core/auth/internal/StitchAuthImpl.ts\"],\"names\":[],\"mappings\":\";AAgBA,OAAO,EAAE,MAAM,EAAE,MAAM,gBAAgB,CAAC;AACxC,OAAO,EACL,QAAQ,EACR,cAAc,EAEd,YAAY,EAEZ,4BAA4B,EAC5B,iBAAiB,EACjB,qBAAqB,EAKtB,MAAM,yBAAyB,CAAC;AAEjC,OAAO,OAAO,MAAM,+BAA+B,CAAC;AAOpD,OAAO,sBAAsB,MAAM,0BAA0B,CAAC;AAC9D,OAAO,YAAY,MAAM,gBAAgB,CAAC;AAE1C,OAAO,mBAAmB,MAAM,uBAAuB,CAAC;AACxD,OAAO,qBAAqB,MAAM,yBAAyB,CAAC;AAC5D,OAAO,KAAK,MAAM,kBAAkB,CAAC;AAErC,IAAM,sBAAsB,GAC1B,gEAAgE,CAAC;AAiCnE;IAA4C,0CAA0B;IAapE,wBACE,aAAkC,EACjB,iBAA6C,EAC7C,WAAoB,EACpB,OAA4B,EAC5B,WAAmC;QAAnC,4BAAA,EAAA,oBAAmC;QALtD,YAOE,kBAAM,aAAa,EAAE,iBAAiB,EAAE,WAAW,CAAC,SACrD;QANkB,uBAAiB,GAAjB,iBAAiB,CAA4B;QAC7C,iBAAW,GAAX,WAAW,CAAS;QACpB,aAAO,GAAP,OAAO,CAAqB;QAC5B,iBAAW,GAAX,WAAW,CAAwB;QAhBrC,eAAS,GAA4B,IAAI,GAAG,EAAE,CAAC;;IAmBhE,CAAC;IAED,sBAAc,uCAAW;aAAzB;YACE,OAAO,IAAI,qBAAqB,CAAC,IAAI,CAAC,CAAC;QACzC,CAAC;;;OAAA;IAEM,0CAAiB,GAAxB,UACE,OAE2C,EAC3C,YAAqB;QAErB,IAAI,2BAA2B,CAAC,OAAO,CAAC,EAAE;YACxC,OAAO,OAAO,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;SACrE;aAAM;YACL,OAAO,OAAO,CAAC,cAAc,CAC3B,YAAa,EACb,IAAI,CAAC,aAAa,EAClB,IAAI,CAAC,UAAU,CAChB,CAAC;SACH;IACH,CAAC;IAEM,4CAAmB,GAA1B,UACE,UAA4B;QAE5B,OAAO,iBAAM,2BAA2B,YAAC,UAAU,CAAC,CAAC;IACvD,CAAC;IAEM,0CAAiB,GAAxB,UAAyB,UAAoC;QACrD,IAAA,qCAAyD,EAAvD,4BAAW,EAAE,gBAAK,CAAsC;QAEhE,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,OAAO,CAC/B,IAAI,CAAC,iBAAiB,CAAC,4BAA4B,CACjD,UAAU,EACV,WAAW,EACX,KAAK,EACL,IAAI,CAAC,UAAU,CAChB,CACF,CAAC;IACJ,CAAC;IAEM,iDAAwB,GAA/B,UACE,IAAgB,EAChB,UAAoC;QAFtC,iBAgCC;QA5BC,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,IAAI,IAAI,CAAC,EAAE,KAAK,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;YACvD,OAAO,OAAO,CAAC,MAAM,CACnB,IAAI,iBAAiB,CAAC,qBAAqB,CAAC,iBAAiB,CAAC,CAC/D,CAAC;SACH;QAEK,IAAA,qCAAyD,EAAvD,4BAAW,EAAE,gBAAK,CAAsC;QAEhE,IAAM,IAAI,GAAG,IAAI,CAAC,iBAAiB,CAAC,gCAAgC,CAClE,UAAU,EACV,WAAW,EACX,KAAK,EACL,IAAI,CAAC,UAAU,CAChB,CAAC;QAEF,OAAO,KAAK,CACV,IAAI,OAAO,CAAC,IAAI,EAAE;YAChB,WAAW,EAAE,SAAS;YACtB,OAAO,EAAE;gBACP,aAAa,EAAE,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,WAAW;aACrD;YACD,IAAI,EAAE,MAAM;SACb,CAAC,CACH,CAAC,IAAI,CAAC,UAAA,QAAQ;YACb,KAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,OAAO,CAC/B,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAE,CAC3C,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,0CAAiB,GAAxB;QACE,IAAI,OAAO,GAAG,KAAK,CAAC;QACpB,IAAI;YACF,OAAO,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,OAAO,CAAC;YACvC,OAAO,OAAO,CAAC;SAChB;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,KAAK,CAAC;SACd;gBAAS;YACR,IAAI,CAAC,OAAO,EAAE;gBACZ,IAAI,CAAC,eAAe,EAAE,CAAC;aACxB;SACF;IACH,CAAC;IAEM,6CAAoB,GAA3B;QACE,IAAI;YACF,IAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;YACrE,IAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;YAErE,IAAM,gBAAgB,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;YAE9C,OAAO,IAAI,CAAC,2BAA2B,CACrC,IAAI,4BAA4B,CAC9B,IAAI,CAAC,qBAAqB,CAAC,gBAAgB,CAAC,EAC5C,YAAY,EACZ,YAAY,EACZ,gBAAgB,CAAC,MAAM,CACxB,CACF,CAAC,IAAI,CAAC,UAAA,IAAI;gBACT,OAAO,IAAI,CAAC;YACd,CAAC,CAAC,CAAC;SACJ;QAAC,OAAO,GAAG,EAAE;YACZ,OAAO,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SAC5B;IACH,CAAC;IAEM,2CAAkB,GAAzB,UACE,IAAoB,EACpB,UAA4B;QAE5B,OAAO,iBAAM,8BAA8B,YAAC,IAAI,EAAE,UAAU,CAAC,CAAC;IAChE,CAAC;IAEM,+BAAM,GAAb;QACE,OAAO,OAAO,CAAC,OAAO,CAAC,iBAAM,cAAc,WAAE,CAAC,CAAC;IACjD,CAAC;IAED,sBAAc,sCAAU;aAAxB;YACE,IAAM,IAAI,GAAG,EAAE,CAAC;YAChB,IAAI,IAAI,CAAC,WAAW,EAAE;gBACpB,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC;aAC9C;YACD,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,KAAK,SAAS,EAAE;gBAC3C,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC;aACvD;YACD,IAAI,IAAI,CAAC,OAAO,CAAC,eAAe,KAAK,SAAS,EAAE;gBAC9C,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC;aAC/D;YAED,IAAM,OAAO,GAAG,MAAM,EAAE,CAAC;YAEzB,IAAI,OAAO,EAAE;gBACX,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC;gBAC3C,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,GAAG,OAAO,CAAC,OAAO,CAAC;aACvD;iBAAM;gBACL,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC;gBACpC,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,GAAG,OAAO,CAAC;aAC/C;YAED,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,GAAG,OAAO,CAAC;YAEzC,OAAO,IAAI,CAAC;QACd,CAAC;;;OAAA;IAEM,wCAAe,GAAtB,UAAuB,QAA4B;QACjD,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAI7B,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;IAC7B,CAAC;IAEM,2CAAkB,GAAzB,UAA0B,QAA4B;QACpD,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IAClC,CAAC;IAEM,oCAAW,GAAlB,UAAmB,QAA6B;QAAhD,iBAYC;QAXC,IAAI,QAAQ,EAAE;YACZ,IAAM,MAAI,GAAG,IAAI,CAAC;YAClB,IAAM,EAAC,GAAG,IAAI,OAAO,CAAC,UAAA,OAAO;gBAC3B,QAAQ,CAAC,WAAW,CAAC,MAAI,CAAC,CAAC;gBAC3B,OAAO,CAAC,SAAS,CAAC,CAAC;YACrB,CAAC,CAAC,CAAC;SACJ;aAAM;YACL,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,GAAG;gBACxB,KAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YACxB,CAAC,CAAC,CAAC;SACJ;IACH,CAAC;IAEO,wCAAe,GAAvB;QACE,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,EAAE,EAAE,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;QAEpE,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;QAC5C,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;QACnD,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;IACrD,CAAC;IAEO,sCAAa,GAArB;QACE,IAAI,OAAO,IAAI,CAAC,WAAW,KAAK,WAAW,EAAE;YAG3C,MAAM,IAAI,mBAAmB,CAAC,sCAAsC,CAAC,CAAC;SACvE;QAED,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,EAAE;YACjE,MAAM,IAAI,mBAAmB,CAAC,oCAAoC,CAAC,CAAC;SACrE;QAED,IAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;QAC1D,IAAM,gBAAgB,GAAG,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;QAErE,OAAO,qBAAqB,CAC1B,gBAAgB,EAChB,QAAQ,EACR,IAAI,CAAC,OAAO,CAAC,WAAW,CACzB,CAAC;IACJ,CAAC;IAEO,8CAAqB,GAA7B,UAA8B,gBAAwC;QACpE,IAAI;YACF,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE;gBAC7B,MAAM,IAAI,mBAAmB,CAAC,yBAAyB,CAAC,CAAC;aAC1D;YAED,IAAI,gBAAgB,CAAC,SAAS,EAAE;gBAE9B,MAAM,IAAI,mBAAmB,CAC3B,8BAA4B,gBAAgB,CAAC,SAAW,CACzD,CAAC;aACH;YAED,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE;gBAC9B,MAAM,IAAI,mBAAmB,CAC3B,qEAAqE,CACtE,CAAC;aACH;SACF;QAAC,OAAO,GAAG,EAAE;YACZ,MAAM,GAAG,CAAC;SACX;gBAAS;YACR,IAAI,CAAC,eAAe,EAAE,CAAC;SACxB;QAED,OAAO,gBAAgB,CAAC,QAAQ,CAAC;IACnC,CAAC;IAEO,wCAAe,GAAvB,UACE,UAAoC;QAEpC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,YAAY,CAAC,YAAY,EAAE,UAAU,CAAC,YAAY,CAAC,CAAC;QACzE,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,YAAY,CAAC,YAAY,EAAE,UAAU,CAAC,YAAY,CAAC,CAAC;QAEzE,IAAI,WAAW,GAAG,UAAU,CAAC,WAAW,CAAC;QACzC,IAAI,WAAW,KAAK,SAAS,EAAE;YAC7B,WAAW,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;SAClC;QAED,IAAM,KAAK,GAAG,aAAa,EAAE,CAAC;QAC9B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,YAAY,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QAEhD,OAAO,EAAE,WAAW,aAAA,EAAE,KAAK,OAAA,EAAE,CAAC;IAChC,CAAC;IAEO,oCAAW,GAAnB;QACE,OAAO;YACL,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,QAAQ;YAClC,IAAI;YACJ,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI;YAC9B,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,QAAQ;SACnC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACb,CAAC;IACH,qBAAC;AAAD,CAAC,AAtRD,CAA4C,cAAc,GAsRzD;;AAED;IACE,IAAI,KAAK,GAAG,EAAE,CAAC;IACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE;QAC3B,KAAK,IAAI,sBAAsB,CAAC,MAAM,CACpC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,sBAAsB,CAAC,MAAM,CAAC,CAC1D,CAAC;KACH;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,4BAA4B,IAAI;IAC9B,IAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC9B,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;QACtB,MAAM,IAAI,mBAAmB,CAC3B,wCAAwC;YACtC,wCAAwC;YACxC,IAAI,CACP,CAAC;KACH;IAEM,IAAA,sBAAW,EAAE,uBAAY,EAAE,iBAAM,EAAE,mBAAQ,CAAU;IAC5D,OAAO,IAAI,QAAQ,CAAC,MAAM,EAAE,QAAQ,EAAE,WAAW,EAAE,YAAY,CAAC,CAAC;AACnE,CAAC;AAED;IAAA;QACS,eAAU,GAAY,KAAK,CAAC;QAG5B,qBAAgB,GAAY,KAAK,CAAC;QAClC,WAAM,GAAY,KAAK,CAAC;IAKjC,CAAC;IAHC,sBAAI,2CAAO;aAAX;YACE,OAAO,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,gBAAgB,CAAC;QAClD,CAAC;;;OAAA;IACH,6BAAC;AAAD,CAAC,AAVD,IAUC;AAED,+BACE,QAAQ,EACR,QAAQ,EACR,cAAc;IAMd,IAAM,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IACjC,IAAM,MAAM,GAA2B,IAAI,sBAAsB,EAAE,CAAC;IACpE,IAAI,CAAC,OAAO,CAAC,UAAA,GAAG;QAEd,IAAM,SAAS,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACjC,IAAM,OAAO,GAAG,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;QAEjD,QAAQ,OAAO,EAAE;YACf,KAAK,sBAAsB,CAAC,WAAW;gBACrC,MAAM,CAAC,SAAS,GAAG,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBACpD,MAAM;YACR,KAAK,sBAAsB,CAAC,QAAQ;gBAClC,IAAI;oBACF,MAAM,CAAC,QAAQ,GAAG,kBAAkB,CAClC,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CACjC,CAAC;iBACH;gBAAC,OAAO,CAAC,EAAE;oBACV,MAAM,CAAC,SAAS,GAAG,CAAC,CAAC;iBACtB;gBACD,MAAM;YACR,KAAK,sBAAsB,CAAC,UAAU;gBACpC,IAAI,SAAS,CAAC,CAAC,CAAC,IAAI,IAAI,EAAE;oBACxB,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC;iBACtB;gBACD,MAAM;YACR,KAAK,sBAAsB,CAAC,KAAK;gBAC/B,IAAM,UAAU,GAAG,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEpD,IAAI,QAAQ,KAAK,UAAU,EAAE;oBAC3B,MAAM,CAAC,UAAU,GAAG,IAAI,CAAC;iBAC1B;gBACD,MAAM;YACR,KAAK,sBAAsB,CAAC,WAAW;gBACrC,IAAM,WAAW,GAAG,kBAAkB,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBACrD,IAAI,cAAc,KAAK,WAAW,EAAE;oBAClC,MAAM,CAAC,gBAAgB,GAAG,IAAI,CAAC;iBAChC;gBACD,MAAM;YACR;gBACE,MAAM;SACT;IACH,CAAC,CAAC,CAAC;IAEH,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,qCACE,OAE2C;IAE3C,OAAO,CACJ,OAA8C,CAAC,SAAS,KAAK,SAAS,CACxE,CAAC;AACJ,CAAC\"}","dts":{"name":"/Users/eric/stitch/stitch-js-sdk/packages/browser/core/.rpt2_cache/placeholder/core/auth/internal/StitchAuthImpl.d.ts","text":"import { CoreStitchAuth, CoreStitchUser, StitchAppClientInfo, StitchCredential, StitchRequestClient, StitchUserFactory, Storage } from \"mongodb-stitch-core-sdk\";\r\nimport AuthProviderClientFactory from \"../providers/internal/AuthProviderClientFactory\";\r\nimport NamedAuthProviderClientFactory from \"../providers/internal/NamedAuthProviderClientFactory\";\r\nimport StitchRedirectCredential from \"../providers/StitchRedirectCredential\";\r\nimport StitchAuth from \"../StitchAuth\";\r\nimport StitchAuthListener from \"../StitchAuthListener\";\r\nimport StitchUser from \"../StitchUser\";\r\nimport StitchBrowserAppAuthRoutes from \"./StitchBrowserAppAuthRoutes\";\r\ninterface PartialLocation {\r\n    hash: string;\r\n    protocol: string;\r\n    host: string;\r\n    pathname: string;\r\n    replace(url: string): any;\r\n}\r\ninterface PartialHistory {\r\n    replaceState(data: any, title?: string, url?: string | null): any;\r\n}\r\ninterface PartialWindow {\r\n    location: PartialLocation;\r\n    history: PartialHistory;\r\n}\r\nexport default class StitchAuthImpl extends CoreStitchAuth<StitchUser> implements StitchAuth {\r\n    private readonly browserAuthRoutes;\r\n    private readonly authStorage;\r\n    private readonly appInfo;\r\n    private readonly jsdomWindow;\r\n    private readonly listeners;\r\n    constructor(requestClient: StitchRequestClient, browserAuthRoutes: StitchBrowserAppAuthRoutes, authStorage: Storage, appInfo: StitchAppClientInfo, jsdomWindow?: PartialWindow);\r\n    protected readonly userFactory: StitchUserFactory<StitchUser>;\r\n    getProviderClient<ClientT>(factory: AuthProviderClientFactory<ClientT> | NamedAuthProviderClientFactory<ClientT>, providerName?: string): ClientT;\r\n    loginWithCredential(credential: StitchCredential): Promise<StitchUser>;\r\n    loginWithRedirect(credential: StitchRedirectCredential): void;\r\n    linkWithRedirectInternal(user: StitchUser, credential: StitchRedirectCredential): any;\r\n    hasRedirectResult(): boolean;\r\n    handleRedirectResult(): Promise<StitchUser>;\r\n    linkWithCredential(user: CoreStitchUser, credential: StitchCredential): Promise<StitchUser>;\r\n    logout(): Promise<void>;\r\n    protected readonly deviceInfo: {};\r\n    addAuthListener(listener: StitchAuthListener): void;\r\n    removeAuthListener(listener: StitchAuthListener): void;\r\n    onAuthEvent(listener?: StitchAuthListener): void;\r\n    private cleanupRedirect;\r\n    private parseRedirect;\r\n    private processRedirectResult;\r\n    private prepareRedirect;\r\n    private pageRootUrl;\r\n}\r\nexport {};\r\n"}}
