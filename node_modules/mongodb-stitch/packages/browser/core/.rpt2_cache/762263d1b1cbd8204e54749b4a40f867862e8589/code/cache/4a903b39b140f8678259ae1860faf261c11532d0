{"code":"import * as tslib_1 from \"tslib\";\r\nimport { ContentTypes, Headers, Response } from \"mongodb-stitch-core-sdk\";\r\nimport EventSourceEventStream from \"./EventSourceEventStream\";\r\nimport fetch from \"fetch-everywhere\";\r\nvar FetchStreamTransport = (function () {\r\n    function FetchStreamTransport() {\r\n    }\r\n    FetchStreamTransport.prototype.roundTrip = function (request) {\r\n        var responsePromise = fetch(request.url, {\r\n            body: request.body,\r\n            headers: request.headers,\r\n            method: request.method\r\n        });\r\n        var responseTextPromise = responsePromise.then(function (response) {\r\n            return response.text();\r\n        });\r\n        return Promise.all([responsePromise, responseTextPromise]).then(function (values) {\r\n            var response = values[0];\r\n            var body = values[1];\r\n            var headers = {};\r\n            response.headers.forEach(function (value, key) {\r\n                headers[key] = value;\r\n            });\r\n            return new Response(headers, response.status, body);\r\n        });\r\n    };\r\n    FetchStreamTransport.prototype.stream = function (request) {\r\n        var rsSupported;\r\n        try {\r\n            new ReadableStream();\r\n            rsSupported = true;\r\n        }\r\n        catch (err) {\r\n            rsSupported = false;\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            if (rsSupported) {\r\n                var headers = tslib_1.__assign({}, request.headers);\r\n                headers[Headers.ACCEPT] = ContentTypes.TEXT_EVENT_STREAM;\r\n                headers[Headers.CONTENT_TYPE] = ContentTypes.TEXT_EVENT_STREAM;\r\n                fetch(request.url, {\r\n                    body: request.body,\r\n                    headers: headers,\r\n                    method: request.method\r\n                })\r\n                    .then(function (response) {\r\n                    var reader = response.body.getReader();\r\n                    console.log(\"got reader!\");\r\n                    console.log(reader);\r\n                })\r\n                    .catch(function (e) { return reject(e); });\r\n            }\r\n            new EventSourceEventStream(new EventSource(request.url), function (stream) { return resolve(stream); });\r\n        });\r\n    };\r\n    return FetchStreamTransport;\r\n}());\r\nexport default FetchStreamTransport;\r\n//# sourceMappingURL=FetchStreamTransport.js.map","map":"{\"version\":3,\"file\":\"FetchStreamTransport.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/core/internal/net/FetchStreamTransport.ts\"],\"names\":[],\"mappings\":\";AAgBA,OAAO,EAEL,YAAY,EAEZ,OAAO,EACP,QAAQ,EAET,MAAM,yBAAyB,CAAC;AACjC,OAAO,sBAAsB,MAAM,0BAA0B,CAAC;AAC9D,OAAO,KAAK,MAAM,kBAAkB,CAAC;AAGrC;IAAA;IAqDA,CAAC;IApDQ,wCAAS,GAAhB,UAAiB,OAAqB;QACpC,IAAM,eAAe,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE;YACzC,IAAI,EAAE,OAAO,CAAC,IAAI;YAClB,OAAO,EAAE,OAAO,CAAC,OAAO;YACxB,MAAM,EAAE,OAAO,CAAC,MAAM;SACvB,CAAC,CAAC;QAEH,IAAM,mBAAmB,GAAG,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ;YACvD,OAAA,QAAQ,CAAC,IAAI,EAAE;QAAf,CAAe,CAChB,CAAC;QAEF,OAAO,OAAO,CAAC,GAAG,CAAC,CAAC,eAAe,EAAE,mBAAmB,CAAC,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM;YACpE,IAAM,QAAQ,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YAC3B,IAAM,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACvB,IAAM,OAAO,GAA8B,EAAE,CAAC;YAC9C,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,UAAC,KAAK,EAAE,GAAG;gBAClC,OAAO,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;YACvB,CAAC,CAAC,CAAC;YACH,OAAO,IAAI,QAAQ,CAAC,OAAO,EAAE,QAAQ,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QACtD,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,qCAAM,GAAb,UAAc,OAAqB;QACjC,IAAI,WAAW,CAAC;QAChB,IAAI;YACF,IAAI,cAAc,EAAE,CAAC;YACrB,WAAW,GAAG,IAAI,CAAC;SACpB;QAAC,OAAO,GAAG,EAAE;YACZ,WAAW,GAAG,KAAK,CAAC;SACrB;QAED,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YACjC,IAAI,WAAW,EAAE;gBACf,IAAI,OAAO,wBAAQ,OAAO,CAAC,OAAO,CAAE,CAAC;gBACrC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,YAAY,CAAC,iBAAiB,CAAC;gBACzD,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC,GAAG,YAAY,CAAC,iBAAiB,CAAC;gBAE/D,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE;oBACjB,IAAI,EAAE,OAAO,CAAC,IAAI;oBAClB,OAAO,EAAE,OAAO;oBAChB,MAAM,EAAE,OAAO,CAAC,MAAM;iBACvB,CAAC;qBACD,IAAI,CAAC,UAAA,QAAQ;oBACZ,IAAM,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;oBACzC,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAA;oBAC1B,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;gBACrB,CAAC,CAAC;qBACD,KAAK,CAAC,UAAA,CAAC,IAAI,OAAA,MAAM,CAAC,CAAC,CAAC,EAAT,CAAS,CAAC,CAAC;aACxB;YACD,IAAI,sBAAsB,CAAC,IAAI,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,UAAA,MAAM,IAAI,OAAA,OAAO,CAAC,MAAM,CAAC,EAAf,CAAe,CAAC,CAAC;QACtF,CAAC,CAAC,CAAC;IACL,CAAC;IACH,2BAAC;AAAD,CAAC,AArDD,IAqDC\"}","dts":{"name":"/Users/eric/stitch/stitch-js-sdk/packages/browser/core/.rpt2_cache/placeholder/core/internal/net/FetchStreamTransport.d.ts","text":"import { BasicRequest, EventStream, Response, Transport } from \"mongodb-stitch-core-sdk\";\r\nexport default class FetchStreamTransport implements Transport {\r\n    roundTrip(request: BasicRequest): Promise<Response>;\r\n    stream(request: BasicRequest): Promise<EventStream>;\r\n}\r\n"}}
